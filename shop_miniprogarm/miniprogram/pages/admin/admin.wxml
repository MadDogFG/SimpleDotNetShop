<view class="container">
  <!-- 顶部标题栏 -->
  <view class="header">
    <text class="header-title">后台管理系统</text>
  </view>
  
 <!-- 底部导航栏 -->
 <view class="tabbar">
   <view class="tabbar-item {{activeTab === 'products' ? 'active' : ''}}" data-tab="products" bindtap="switchTab">
     <image src="/images/product.png" class="tab-icon" />
     <text>商品管理</text>
   </view>
   <view class="tabbar-item {{activeTab === 'orders' ? 'active' : ''}}" data-tab="orders" bindtap="switchTab">
     <image src="/images/order.png" class="tab-icon" />
     <text>订单管理</text>
   </view>
   <view class="tabbar-item {{activeTab === 'users' ? 'active' : ''}}" data-tab="users" bindtap="switchTab">
     <image src="/images/user.png" class="tab-icon" />
     <text>用户管理</text>
   </view>
   <view class="tabbar-item {{activeTab === 'stats' ? 'active' : ''}}" data-tab="stats" bindtap="switchTab">
     <image src="/images/statistics.png" class="tab-icon" />
     <text>统计</text>
   </view>
   <view class="tabbar-item {{activeTab === 'profile' ? 'active' : ''}}" data-tab="profile" bindtap="switchTab">
     <image src="/images/profile.png" class="tab-icon" />
     <text>个人中心</text>
   </view>
 </view>
  
  <!-- 商品列表区域 (3x3网格) -->
  <view class="content">
    <view class="product-grid">
      <block wx:for="{{products}}" wx:key="index">
        <view wx:if="{{!item.empty}}" 
              class="product-item {{item.isDeleted ? 'deleted' : ''}} {{selectedId === item.id ? 'selected' : ''}}"
              bindtap="navigateToEdit"
              data-id="{{item.id}}">
          <!-- 删除按钮 -->
          <image 
            wx:if="{{!item.isDeleted}}"
            class="delete-icon"
            src="/images/delete.png"
            catchtap="handleDelete"
            data-id="{{item.id}}" 
            data-name="{{item.name}}"
          />
          
          <!-- 商品图片 -->
          <image src="{{'/images/'+item.imageUrl || '/images/default-product.png'}}" class="product-image" mode="aspectFill" />
          
          <!-- 商品信息 -->
          <view class="product-info">
            <text class="product-name">{{item.name}}</text>
            <text class="product-price">¥{{item.price}}</text>
            <text class="product-stock">库存: {{item.stock}}</text>
          </view>
          
          <!-- 删除状态标记 -->
          <view wx:if="{{item.isDeleted}}" class="deleted-tag">已删除</view>
        </view>
        
        <!-- 空占位项 -->
        <view wx:else class="product-item empty">
          <text>无商品</text>
        </view>
      </block>
    </view>
  </view>

  <!-- 分页器 -->
  <view class="pagination">
    <button 
      class="page-btn" 
      disabled="{{currentPage === 1}}" 
      bindtap="handlePageChange" 
      data-type="prev"
    >
      上一页
    </button>
    
    <view class="page-info">
      {{currentPage}} / {{totalPages}}
    </view>
    
    <button 
      class="page-btn" 
      disabled="{{currentPage === totalPages}}" 
      bindtap="handlePageChange" 
      data-type="next"
    >
      下一页
    </button>
  </view>
  
  <!-- 添加商品按钮 -->
  <button class="add-button" bindtap="navigateToAdd">添加商品</button>
  
  <!-- 删除确认弹窗 -->
  <view wx:if="{{selectedId}}" class="delete-confirm">
    <text>确定要删除"{{selectedProductName}}"吗？</text>
    <view class="confirm-buttons">
      <button class="confirm-btn" bindtap="confirmDelete">删除</button>
      <button class="cancel-btn" bindtap="cancelSelect">取消</button>
    </view>
  </view>
  
  <!-- 加载指示器 -->
  <view wx:if="{{loading}}" class="loading-overlay">
    <view class="loading-spinner"></view>
    <text>加载中...</text>
  </view>

  <!-- 添加/编辑商品弹窗 -->
  <view wx:if="{{showModal}}" class="modal-overlay">
    <view class="modal">
      <view class="modal-header">
        <text>{{modalTitle}}</text>
        <!-- 恢复上架按钮 - 只在编辑弹窗且商品已删除时显示 -->
        <button wx:if="{{modalTitle === '编辑商品' && formData.isDeleted}}" 
                class="restore-btn"
                bindtap="restoreProduct"
                disabled="{{loading}}"> 恢复上架</button>
        <image src="/images/close.png" class="close-icon" bindtap="closeModal" />
      </view>
      
      <scroll-view scroll-y="true" class="modal-body">
        <view class="form-item">
          <text class="form-label">商品名称</text>
          <input 
            placeholder="请输入商品名称" 
            value="{{formData.name}}" 
            bindinput="handleInputChange" 
            data-field="name" 
          />
        </view>
        <view class="form-item">
          <text class="form-label">商品价格(¥)</text>
          <input 
            type="digit" 
            placeholder="0.00" 
            value="{{formData.price}}" 
            bindinput="handleInputChange" 
            data-field="price" 
          />
        </view>
        <view class="form-item">
          <text class="form-label">商品库存</text>
          <input 
            type="number" 
            placeholder="0" 
            value="{{formData.stock}}" 
            bindinput="handleInputChange" 
            data-field="stock" 
          />
        </view>
        <view class="form-item">
          <text class="form-label">商品图片URL</text>
          <textarea 
            placeholder="请输入图片链接" 
            value="{{formData.imageUrl}}" 
            bindinput="handleInputChange" 
            data-field="imageUrl" 
            auto-height
          />
        </view>
      </scroll-view>
      
      <view class="modal-footer">
        <button class="modal-btn cancel" bindtap="closeModal">取消</button>
        <button class="modal-btn submit" bindtap="submitForm" disabled="{{loading}}">确定</button>
      </view>
    </view>
  </view>
</view>